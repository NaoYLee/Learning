#

## Hadoop

### - Hadoop的核心组件及其对应功能

- HDFS，分布式文件系统，负责分布式存储数据及文件管理
  - 副本机制：默认3份副本，保证数据安全
  - 分块机制：将文件分为最大128MB的若干块，加快传输速度
  - 主备架构：高可用性架构，解决 `NameNode` 单点故障隐患
- MapReduce，分布式并行计算框架，负责进行数据处理
- YARN，分布式资源管理系统，负责任务管理及资源调度

## HDFS

### - HDFS为什么不支持随时编辑

MapReduce的工作原理是将文件数据划分为若干块，调用若干 `DataNode` 进行数据处理，并将处理完毕的若干块重新整合为一个文件

### - HDFS中的小文件为何会影响系统性能

每个文件不论本身大小都会在 `NameNode` 中存储相同大小的文件元数据，若小文件过多会导致 `NameNode` 内存被大量占用，影响系统性能

## MapReduce

### - Block数据块和Split切片的是一一对应的吗

Block数据块和Split切片之间**没有固定的数量对应关系**，默认一一对应，它们的数量主要取决于以下因素：

- **数据块大小和切片大小**
  - **数据块大小**：在分布式文件系统（如 HDFS）中，数据块的大小通常是固定的，比如 HDFS 默认是128MB。数据块的主要目的是将大文件分割成多个部分，方便分布式存储和容错。
  - **切片大小**：切片的大小主要由 MapReduce 框架根据数据的输入格式和用户的配置来确定。默认情况下，切片大小通常与数据块大小相同，但可以根据需要进行调整。例如，如果设置的切片大小为 64MB，那么一个128MB 的数据块会被切分为两个切片。
- **输入格式**
  - **文本文件**：对于文本文件，切片的划分通常以行为单位。如果数据块中的文本行被完整地包含在一个数据块中，那么切片数量可能与数据块数量一致。但如果文本行跨越多个数据块，那么一个切片可能包含多个数据块中的部分数据。
  - **压缩文件**：如果文件是压缩格式存储，且压缩方式不支持分割（如gzip），那么整个文件只能作为一个切片处理。即使它存储在多个数据块中，切片数量也只有一个。
- **数据分布和处理需求**
  - **数据分布不均**：如果数据在数据块中的分布不均匀，某些数据块可能包含大量的记录，而其他数据块包含较少的记录。为了平衡 Map 任务的负载，可能需要将较大的数据块切分为多个切片，或者将较小的数据块合并为一个切片。
  - **处理需求**：用户的处理需求也会影响切片的数量。如果需要更高的并行度，可能会将数据块切分为更小的切片，以便更多的 Map 任务可以并行处理。
- **文件结构和元数据**
  - **文件结构特殊**：有些文件格式可能包含文件头、文件尾或其他元信息，这些部分在切片时可能需要特殊处理。例如，文件头可能需要被包含在第一个切片中，而文件尾可能需要被包含在最后一个切片中。
  - **元数据处理**：如果文件包含元数据（如 XML 文件的标签），切片时需要考虑元数据的完整性和正确性，可能会导致切片与数据块的对应关系发生变化。

### - Split切片和MapTask是一一对应的吗

**是的**，一个Split切片一定会启动一个MapTask

## SQL

### DROP DELETE TRUNCATE 的区别

`DROP`针对表空间及表，不涉及表中数据

| `DELETE` | `TRUNCATE` |
| - | - |
| 可以选择删除对象 | 删除整张表 |
| 按行删除数据，保留表结构 | 先摧毁表，再原样重构 |
| 可能产生碎片 | 不会产生碎片 |
| 不释放空间 | 立即释放空间 |
| 可以rollback | 无法恢复 |

### SQL中去重查询的方式

| 方法 | 主要用途 | 是否改变原数据 | 性能考虑 | 适用场景 |
| - | - | - | - | - |
| `DISTINCT` | 查询结果去重 | 否 | 大数据量可能较慢 | 简单查询去重 |
| `GROUP BY` | 分组聚合或去重 | 否 | 与 `DISTINCT` 类似 | 需要聚合操作或去重 |
| `ROWID` | 物理删除重复行 | 是 | 高效(直接定位行) | 清理表中重复数据 |

### 聚合函数 count(*) count(1) count(\<column>) 的区别

| 函数 | 计数依据 |
| - | - |
| `count(*)` | 所有行(行的存在) |
| `count(1)` | 和 `count(*)` 完全相同 |
| `count(<column>)` | 指定字段中非 `NULL` 的值 |

## 数据库与数仓

### 数据库的优化

1. 建表时设置分区
2. 设置索引

### 数据库和数据仓库的区别

| 数据库 | 数据仓库 |
| - | - |
| 面向业务数据进行增删改查 | 面向业务需求主题进行数据分析 |
| OLTP事务处理型工作 | OLAP分析型工作 |
| 数据量级中等 | 数量级较大 |
| 中小型数据计算效率高 | 计算比较耗时 |

### 数仓为什么要分层

1. 规范数据处理流程
2. 便于数据溯源
3. 构建中间表，减少数据重复开发，避免重复造轮子
4. 与源系统解耦合
5. 通过数据冗余存储提高数据处理效率

### 数仓是如何分层的

ODS层/临时存储层/贴源层

- 临时存储从源系统获得的数据
- 与源系统解耦合

DWD层/数据明细层

- 存储经ODS层清洗转换的数据
- 数据规整一致

DWS层/轻度汇总层/主题宽表层

- 区分事实表与维度表，根据维度进行建模
- 将相同主题的数据聚合为一张宽表

ADS层/数据应用层

- 根据最终指标进行加工计算
- 向下游提供数据支持

### ETL工具

- Kettle
- informatica
